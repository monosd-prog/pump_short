# Pump Short Bot (MVP)

Автоматический сервис для отслеживания пампов и поиска точек входа в шорт  
на основе рыночной структуры, OI, CVD, объёма и ATR.

Проект запущен как MVP и предназначен для:
- сбора датасета,
- тюнинга порогов,
- последующего ML-отбора сетапов.

---

## Как работает система (по шагам)

### 1. Приём сигнала
Сервис принимает сигнал о пампе через HTTP API:

POST /pump

Источник сигнала:
- внешний бот / вебхук
- ручной POST (для тестов)

В сигнале передаются:
- symbol (например BTCUSDT)
- exchange (bybit)
- pump_pct
- pump_ts
- extra (опциональные поля)

---

### 2. Фильтрация сигнала
Перед запуском отслеживания применяются фильтры:
- минимальный процент пампа (`MIN_PUMP_PCT`)
- проверка окна (опционально, 10m)
- анти-спам:
  - не более `MAX_CONCURRENT` активных монет
  - cooldown по символу (`COOLDOWN_MINUTES`)
  - защита от повторного запуска

---

### 3. Запуск отслеживания (WATCH START)
Если сигнал принят:
- создаётся `run_id`
- монета попадает в `active`
- запускается watcher в отдельном потоке
- начинается сбор контекста

---

### 4. Контекст 5m (основа логики)
На таймфрейме 5m:
- цена и структура движения
- Open Interest и его динамика
- CVD / агрессия
- объём и Z-score
- ATR
- расстояние от пика пампа

Все данные логируются в CSV.

---

### 5. Переход в ARMED
Когда контекст соответствует условиям:
- watcher переходит в режим `ARMED`
- включается более частый polling:
  - 1m
  - fast-режим (10–15 сек)

---

### 6. Поиск входа (ENTRY)
В режиме ARMED:
- анализ 1m и fast-окон
- два типа входа:
  - EARLY — ранний, агрессивный
  - CONFIRM — подтверждённый

При выполнении условий фиксируется `ENTRY_OK`.

---

### 7. Отслеживание исхода (OUTCOME)
После ENTRY_OK:
- включается трекинг результата
- варианты исхода:
  - TP
  - SL
  - TIMEOUT (по времени)

Результат логируется и сохраняется.

---

## Стадии и состояния

### Структурные стадии (5m)
- STAGE_0 — старт наблюдения
- STAGE_1_DROP1 — первый слив от пика
- STAGE_2_BOUNCE1 — первый отскок
- STAGE_3_DROP2 — второй слив
- STAGE_4_BOUNCE2 — второй отскок

---

### Режимы watcher
- WATCHING_5M — сбор контекста
- ARMED — активный поиск входа

---

### События
- WATCH START
- ARMED
- ENTRY_OK (EARLY / CONFIRM)
- OUTCOME (TP / SL / TIMEOUT)

---

## Telegram-уведомления

Поддерживаются уведомления:
- старт отслеживания
- вход (ENTRY_OK)
- результат сделки (OUTCOME)

Настраиваются через `.env`.

---

## Конфигурация (.env)

Пример:

TELEGRAM_BOT_TOKEN=…

TELEGRAM_CHAT_ID=…

MAX_CONCURRENT=5

COOLDOWN_MINUTES=45

MIN_PUMP_PCT=8.0

TG_SEND_OUTCOME=1

---

## Статус проекта

MVP запущен и стабильно работает на VPS (24/7).

Текущая цель:
- сбор датасета,
- анализ статистики,
- подготовка к ML-отбору сетапов.